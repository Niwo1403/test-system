<br>

# User Manual

<br><br>

## Introduction
**_Note: in the following section links will use "your-domain.com" as domain in links, replace if with your actual domain to get the correct links_**
- The test system is intended to allow customizable tests to be displayed, answered and exported
  - Access to execute a test is granted using a token
- A token can be created at https://your-domain.com/token.html, if you got a valid username and password
- On the start screen at https://your-domain.com/index.html a token (&rarr; [about tokens in database](#token-table)) can be entered to execute a [test](#test-table), which consists of:
  - One _PERSONAL_DATA_TEST_, which collects base data about the answerer
  - Any number of _PRE_COLLECT_TESTS_, which collect any not exported data
  - One _EXPORTABLE_TEST_, which can contain questions, whose answers will be exported
- After answering all questions, the user will be redirected to the result side, showing a PDF with the results (generated by the server)
  - The user is only be able to generate the PDF, if the token isn't expired and has at least one usage left (a token can have multiple usages)

<br><br>

## General database structure

### **token_creator** table
- Contains usernames & hashed passwords for authorization of token creation
  - Note: the password will be encrypted, so you can (& should) neither read nor change the password like the other values in the database (in case you need another user or like to change username or password, you probably should ask a developer)

### **token** table
- Contains the tokens, consisting of the actual token, information regarding usages & expiring, and the tests, which should be answered
  - Each token got exactly one _PERSONAL_DATA_TEST_ (to identify test answerer) and _EXPORTABLE_TEST_ (which will be exported), but there can be any number of _PRE_COLLECT_TESTS_

### **test** table
- Contains the names (to identify the test), descriptions (which define the questions, etc.) and categories of the tests
  - The test category can be:
    - _PERSONAL_DATA_TEST_: for tests which are used to collect information about the answering person
    - _PRE_COLLECT_TEST_: for tests whose answers won't be exported
    - _EXPORTABLE_TEST_: for tests whose answers should be exported

### Test answer tables
- Table **_"test_answer"_**: contains an answer for the tests, a reference to the personal data answer and a reference to the test, which was answered
- Table **_"exportable_test_answer"_**: references the test answers (in table _"test_answers"_), which can be exported

<br><br>

## Database connection

### Install pgAdmin
- Download pgAdmin installer [here](https://www.pgadmin.org/download/)
- Run installer and click through it until it's finished 
- Now pgAdmin should be installed, so test starting it
  - To start on:
    - **Windows**: press the Windows key (which opens a menu), type "pgAdmin" (which should start a search), check whether pgAdmin is shown as "App" ("App" should be standing below pgAdmin) and click on it
    - **MacOS**: open the _"Finder"_, select _"Applications"_ and search for "pgAdmin" (possibly with a following number after the name) and open it
  - When you start pgAdmin the first time, you will be asked to enter a master password - enter it and remember it, you will need it each time, you start pgAdmin

### Add database
- Start pgAdmin and enter the master password selected by you earlier
- Follow the instructions in [this answer](https://stackoverflow.com/questions/11769860/connect-to-a-heroku-database-with-pgadmin#answer-63046594) to add the database connection
  - Choose by yourself, whether you want to save the database password or not
  - Note: the credentials of the database will change regularly, they may have to be changed in future
- After the instructions click "Save" to save the database connection
- Now the servers can be found on the left side of the window
  - Now there should be an entry with the database name, which you just set (you may need to unfold the server entry to see the database)

<br><br>

## Access database in pgAdmin

### Find tables
- Tables can be found here: Servers \> _\<SERVER_NAME\>_ \> Databases \> _\<DATABASE\>_ \> Schemas \> public \> Tables
  - With _\<SERVER_NAME\>_ being your chosen server name and _\<DATABASE\>_ being the database name from the database credentials

### Show & export data
- Find the table to show data from  (&rarr; [how to find tables](#find-tables))
- All data inside a table can be shown by: right click on table \> View/Edit Data \> All Rows
  - Alternatively the "View Data" button can be used - it's the second button at the right of the "Browser" label, showing a table (marked orange in image): ![See image at img/pgAdmin - View Data.png](img/pgAdmin%20-%20View%20Data.png)
- The shown data can be downloaded as CSV by clicking F8 or the download symbol at the right top, second from left (marked orange in image): ![See image at img/pgAdmin - Download.png](img/pgAdmin%20-%20Download.png)
  - The downloaded CSV file can be imported to excel by following the instructions [here](https://support.microsoft.com/en-us/office/import-or-export-text-txt-or-csv-files-5250ac4c-663c-47ce-937b-339e391393ba#ID0EBBN-supTabControlContent-1) or by following the next bullet points
    - In Excel: Data (_de:_ Daten) \> Get Data (_de:_ Daten abrufen) \> From File (_de:_ Aus Datei) \> From Text/CSV (_de:_ Aus Text/CSV)
    - Select the exported CSV file in the opened menu, click import and a preview will be shown
      - In case the preview is displayed wrongly, the "Delimiter" (_de:_ Trennzeichen) may have to be adjusted
      - In case the preview is displayed correctly, click "Load" (_de:_ Laden) to import the table
- If the data you want to access exist as "Heroku Dataclip", you can also access it directly on [Heroku Dataclips website](https://data.heroku.com/dataclips)
  - Select a dataclip in the list to show its data; in the shown data the "CSV" button can be used 

### Change & save data
- In the shown table (&rarr; [how to show data](#show--export-data)):
  - **Rows can be added** by scrolling to the bottom of the table and entering the values in the empty fields of the last row
  - **Values can be changed** by clicking on them twice
    - After clicking, you can either enter a new value into the table directly or a small window will pop up, offering you to enter a new value
  - **Rows can be deleted** by clicking on the most left number of the row and clicking the "Delete" button above the "Query Editor" (marked orange in image): ![See image at img/pgAdmin - Delete.png](img/pgAdmin%20-%20Delete.png)
- To save the locally changed values to the database click F6 or the "Save Data Changes" button above the "Query Editor" (marked orange in image): ![See image at img/pgAdmin - Save Data Changes.png](img/pgAdmin%20-%20Save%20Data%20Changes.png)

### Specific tasks

#### Add or change tests
- Create or adjust your test using the [survey creator](https://surveyjs.io/create-survey-v2) of SurveyJS
  - In case you want to **change an existing test**: open table _"tests"_ (&rarr; [how to find tables](#find-tables)) in pgAdmin, search the row of the test you like to change, doubleclick the value of _"description_json"_ and copy the content of the pop-up window into the _"JSON Editor"_ tab of the website linked above (then navigate back to tab _"Designer"_ to change test)
- After changing: select the _"JSON Editor"_ tab, select all text (from **{** to **}**) and copy the selected JSON description
- In pgAdmin open table _"tests"_ (&rarr; [how to find tables](#find-tables)) and show its data (&rarr; [how to show data](#show--export-data))
- Now either:
  - **Replace another test**: find the row of the test to replace, paste in its _"description_json"_ column the description you previously copied and save the change (&rarr; [how to change & save data](#change--save-data))
    - You may change the _"category"_ as well, but be careful - if the test was already or is still used in tokens this probably causes errors!
  - **Add a new test**: add a new row with the following values and save the change (&rarr; [how to change & save data](#change--save-data)):
    - Enter your new test name (which must not exist before) to column _"name"_
    - Enter the JSON description (you previously copied) to column _"description_json"_
    - Enter a category (which must be _PERSONAL_DATA_TEST_, _EXPORTABLE_TEST_ or _PRE_COLLECT_TEST_) to column _"test_category"_

#### Adjust token
- Disable expiring: open table _"token"_ (&rarr; [how to find tables](#find-tables))
  - Find the row of the token you want to change, doubleclick the value in the _"creation_timestamp"_ column, delete its value in the pop-up window (after deletion value should be _"[null]"_) and save changes to database (&rarr; [how to change & save data](#change--save-data))
- Adjust remaining usages of token: change _"max_usage_count"_ value of row in _"token"_ table (&rarr; [how to change & save data](#change--save-data))
  - Delete the value to have unlimited usages (after deletion value should be _"[null]"_ , not _"0"_ or another number)

<br><br>

## Database backups

- Open https://dashboard.heroku.com/apps/your-app-name/resources with _your-app-name_ being the name of your Heroku app and click on your _"Heroku Postgres"_ database
- In the website you will be redirected to, select the _"Durability"_ tab - here you can:
  - **Create** database backups by clicking _"Create Manual Backup"_
  - **Download** or **Delete** database backups with the _"Download"_ and _"Delete"_ buttons next to the shown backups
    - There are only backups shown, if you have created one already

<br><br>

## Grant developer access to heroku (server)

_Note: you can only add a collaborator, if you already have access_
- Click "Add Collaborator" at https://dashboard.heroku.com/apps/your-app-name/access with _your-app-name_ being the name of your Heroku app
  - Enter email address of the developer and click "Save changes"

<br><br><br><br><br><br><br><br><br><br> <br><br><br><br><br><br><br><br><br><br>
